
CREATE OR REPLACE PROCEDURE uprav_knihu(p_id_knihy IN NUMBER, p_sloupec IN VARCHAR2, p_hodnota IN VARCHAR2)
    IS 
        CLMCOUNT NUMBER;
        CLMNAMES VARCHAR2(100);
        CMD VARCHAR2(32767);
        NOTFOUND EXCEPTION;
        PRAGMA EXCEPTION_INIT(NOTFOUND, -2291);
begin

    SELECT COUNT(COLUMN_NAME) INTO CLMCOUNT FROM SYS.ALL_TAB_COLUMNS
        WHERE TABLE_NAME = 'KNIHA';

    IF  CLMCOUNT <= 0 THEN
        DBMS_OUTPUT.PUT_LINE('TakovÃ½to sloupec neexistuje');
        FOR CLMNAMES IN (SELECT COLUMN_NAME FROM ALL_TAB_COLUMNS WHERE UPPER(TABLE_NAME) = 'KNIHA')
        loop
            DBMS_OUTPUT.PUT(CLMNAMES.COLUMN_NAME || ', ');
        END LOOP;
    ELSE
        CMD := 'UPDATE KNIHA SET ' || p_sloupec || '=''' || p_hodnota || ' WHERE ID_KNIHY = ' || p_id_knihy;
        EXECUTE IMMEDIATE CMD;
    END IF;

    EXCEPTION WHEN NOTFOUND THEN 
        RAISE_APPLICATION_ERROR(-122345566, 'BOOK NOT FOUND!');
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-111111, 'UNHANDLED EXCEPTION!');
        DBMS_OUTPUT.PUT_LINE(SQLCODE || ' ' || SQLERRM(SQLCODE));

END;